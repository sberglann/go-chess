<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Chess</title>
    <link rel="stylesheet" href="css/chessboard-1.0.0.min.css">
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
    <script src="js/chessboard-1.0.0.min.js"></script>
</head>
<body>
<div id="board" style="width: 400px"></div>
<script>
    function sendPosition(source, target, piece, newPos, oldPos, orientation) {
        console.log('New position: ' + Chessboard.objToFen(newPos))
        var prevTurn = piece[0]
        var nextTurn = prevTurn == "w" ? "b" : "w"
        console.log(prevTurn)
        console.log(nextTurn)
        socket.send(Chessboard.objToFen(newPos).concat(" ", nextTurn));
    }

    var socket = new WebSocket("ws://localhost:8080/echo");
    var boardConfig = {
        draggable: true,
        dropOffBoard: 'snapback',
        onDrop: sendPosition
    }
    var board = Chessboard('board', boardConfig);

    socket.onopen = function () {
        board.start(false)
    };

    socket.onmessage = function (e) {
        board.position(e.data, false)
    };
</script>
</body>
</html>